# Railway 배포 플로우차트

## 전체 배포 프로세스 시각화

```
┌─────────────────────────────────────────────────────────────────┐
│                    Railway 배포 시작                              │
│              https://railway.app 접속 & 로그인                    │
└─────────────────┬───────────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────────┐
│              1단계: 새 프로젝트 생성                              │
│                                                                   │
│  New Project → Empty Project                                     │
│  프로젝트 이름: nym-app                                          │
└─────────────────┬───────────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────────┐
│              2단계: PostgreSQL 데이터베이스                       │
│                                                                   │
│  + New → Database → Add PostgreSQL                               │
│  ✓ DATABASE_URL 자동 생성                                        │
└─────────────────┬───────────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────────┐
│              3단계: 백엔드 서비스 배포                            │
│                                                                   │
│  + New → GitHub Repo → 888tyui/nymp                              │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Settings 설정                                             │   │
│  │  • Root Directory: backend                               │   │
│  │  • Build: npm install && npm run build                   │   │
│  │  • Start: npm run start                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Variables 설정                                            │   │
│  │  • DATABASE_URL = (PostgreSQL 참조)                      │   │
│  │  • OPENAI_API_KEY = sk-...                               │   │
│  │  • PORT = 3001                                           │   │
│  │  • NODE_ENV = production                                 │   │
│  │  • FRONTEND_URL = (나중에)                               │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Networking                                                │   │
│  │  • Generate Domain                                        │   │
│  │  • URL: https://backend-xxx.up.railway.app              │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────┬───────────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────────┐
│              4단계: 프론트엔드 서비스 배포                        │
│                                                                   │
│  + New → GitHub Repo → 888tyui/nymp (다시 추가)                  │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Settings 설정                                             │   │
│  │  • 서비스 이름: frontend                                  │   │
│  │  • Root Directory: frontend                              │   │
│  │  • Build: npm install && npm run build                   │   │
│  │  • Start: npm run start                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Variables 설정                                            │   │
│  │  • NEXT_PUBLIC_API_URL = (백엔드 URL)                    │   │
│  │  • NEXT_PUBLIC_MONAD_RPC_URL = monad-rpc-url            │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Networking                                                │   │
│  │  • Generate Domain                                        │   │
│  │  • URL: https://frontend-xxx.up.railway.app             │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────┬───────────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────────┐
│              5단계: 백엔드 FRONTEND_URL 업데이트                  │
│                                                                   │
│  백엔드 서비스 → Variables                                       │
│  FRONTEND_URL = https://frontend-xxx.up.railway.app              │
│  저장 → 자동 재배포                                              │
└─────────────────┬───────────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────────┐
│              6단계: 배포 확인 및 테스트                           │
│                                                                   │
│  ✓ PostgreSQL: Running                                           │
│  ✓ Backend: Running                                              │
│  ✓ Frontend: Running                                             │
│                                                                   │
│  테스트:                                                          │
│  • https://backend-xxx.up.railway.app/health                    │
│  • https://frontend-xxx.up.railway.app                          │
└─────────────────┬───────────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                  ✅ 배포 완료! 🎉                                │
│                                                                   │
│  nym 앱이 Railway에서 실행 중입니다!                            │
└─────────────────────────────────────────────────────────────────┘
```

---

## 서비스 간 연결 구조

```
┌────────────────────────────────────────────────────────────────┐
│                        Railway Project: nym-app                 │
│                                                                  │
│  ┌──────────────────┐      ┌──────────────────┐               │
│  │   PostgreSQL     │      │     Backend      │               │
│  │   Database       │◄─────│   (Express)      │               │
│  │                  │ DB   │                  │               │
│  │ DATABASE_URL     │      │ Port: 3001       │               │
│  └──────────────────┘      └────────┬─────────┘               │
│                                      │                          │
│                                      │ API                      │
│                                      │                          │
│                             ┌────────▼─────────┐               │
│                             │    Frontend      │               │
│                             │    (Next.js)     │               │
│                             │                  │               │
│                             │ Port: 3000       │               │
│                             └──────────────────┘               │
│                                      │                          │
└──────────────────────────────────────┼──────────────────────────┘
                                       │
                                       │ HTTPS
                                       │
                                       ▼
                              ┌────────────────┐
                              │     Users      │
                              │   (Browser)    │
                              └────────────────┘
```

---

## 환경 변수 흐름

```
PostgreSQL Service
    │
    │ DATABASE_URL
    ├─────────────────────────► Backend Service
    │                              │
    │                              │ OPENAI_API_KEY (사용자 입력)
    │                              │ PORT=3001
    │                              │ NODE_ENV=production
    │                              │ FRONTEND_URL ──────┐
    │                              │                     │
    │                              ├─ Generates Domain  │
    │                              │                     │
    │                              ▼                     │
    │                    https://backend-xxx...         │
    │                              │                     │
    │                              │                     │
    │                              ▼                     │
    │                                                    │
    │                    Frontend Service               │
    │                              │                     │
    │                              │ NEXT_PUBLIC_API_URL◄┘
    │                              │   (백엔드 URL)
    │                              │
    │                              │ NEXT_PUBLIC_MONAD_RPC_URL
    │                              │
    │                              ├─ Generates Domain
    │                              │
    │                              ▼
    │                    https://frontend-xxx...
    │                              │
    └──────────────────────────────┘
         (FRONTEND_URL 업데이트)
```

---

## 배포 타임라인

```
시간   단계                           상태
────────────────────────────────────────────────────
0:00   프로젝트 생성                 ⚪ 시작
0:30   PostgreSQL 추가               🟡 진행 중
1:00   백엔드 서비스 추가            🟡 진행 중
1:30   백엔드 빌드 시작              🟡 빌드 중
2:00   백엔드 배포 완료              🟢 완료
2:30   프론트엔드 서비스 추가        🟡 진행 중
3:00   프론트엔드 빌드 시작          🟡 빌드 중
4:00   프론트엔드 배포 완료          🟢 완료
4:30   백엔드 환경 변수 업데이트     🟡 재배포 중
5:00   전체 배포 완료                ✅ 성공!
```

---

## 문제 해결 플로우

```
배포 실패?
   │
   ├─ 백엔드 Crashed?
   │    │
   │    ├─ DATABASE_URL 확인
   │    │    └─ PostgreSQL Reference로 설정?
   │    │
   │    ├─ OPENAI_API_KEY 확인
   │    │    └─ sk-로 시작하는 유효한 키?
   │    │
   │    └─ 빌드 로그 확인
   │         └─ Deployments → View Logs
   │
   ├─ 프론트엔드 빌드 실패?
   │    │
   │    ├─ NEXT_PUBLIC_API_URL 확인
   │    │    └─ 백엔드 URL이 정확한가?
   │    │
   │    └─ 로컬에서 빌드 테스트
   │         └─ npm run build
   │
   └─ CORS 에러?
        │
        ├─ 백엔드 FRONTEND_URL 확인
        │    └─ 프론트엔드 URL과 정확히 일치?
        │
        └─ 백엔드 재배포
             └─ Deployments → Redeploy
```

---

## 자동 배포 워크플로우

```
Developer                    GitHub                    Railway
    │                          │                          │
    │ git push origin main     │                          │
    ├─────────────────────────►│                          │
    │                          │                          │
    │                          │ Webhook Trigger          │
    │                          ├─────────────────────────►│
    │                          │                          │
    │                          │                          │ Build Start
    │                          │                          ├──────────┐
    │                          │                          │          │
    │                          │                          │◄─────────┘
    │                          │                          │ Build Complete
    │                          │                          │
    │                          │                          │ Deploy
    │                          │                          ├──────────┐
    │                          │                          │          │
    │                          │                          │◄─────────┘
    │                          │                          │ Deploy Complete
    │                          │                          │
    │         Deployment       │         Success          │
    │◄─────────────────────────┴─────────────────────────┤
    │         Notification                                │
    │                                                      │
```

---

## 모니터링 대시보드

```
┌─────────────────────────────────────────────────────────┐
│                Railway Dashboard                         │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  Services Status                                          │
│  ┌─────────────┬─────────┬──────────┬─────────────┐     │
│  │ Service     │ Status  │ CPU      │ Memory      │     │
│  ├─────────────┼─────────┼──────────┼─────────────┤     │
│  │ PostgreSQL  │ 🟢 Up   │ 5%       │ 128 MB      │     │
│  │ Backend     │ 🟢 Up   │ 12%      │ 256 MB      │     │
│  │ Frontend    │ 🟢 Up   │ 8%       │ 512 MB      │     │
│  └─────────────┴─────────┴──────────┴─────────────┘     │
│                                                           │
│  Recent Deployments                                       │
│  ┌────────────────────────────────────────────────┐     │
│  │ ✅ main@a1b2c3d - 2 min ago - Success          │     │
│  │ ✅ main@x9y8z7 - 1 hour ago - Success          │     │
│  │ ✅ main@p0q9r8 - 3 hours ago - Success         │     │
│  └────────────────────────────────────────────────┘     │
│                                                           │
│  Usage This Month                                         │
│  ┌────────────────────────────────────────────────┐     │
│  │ Credit Used: $2.50 / $5.00                     │     │
│  │ ████████████░░░░░░░░░░░░░░ 50%                │     │
│  └────────────────────────────────────────────────┘     │
│                                                           │
└─────────────────────────────────────────────────────────┘
```

---

## 체크리스트 플로우

```
배포 전
  ├─ [ ] Railway 계정 생성
  ├─ [ ] GitHub 연결
  ├─ [ ] OpenAI API 키 준비
  └─ [ ] 신용카드 등록

배포 중
  ├─ [ ] 프로젝트 생성
  ├─ [ ] PostgreSQL 추가
  ├─ [ ] 백엔드 배포
  │     ├─ [ ] Root Directory 설정
  │     ├─ [ ] Build/Start 명령어
  │     ├─ [ ] 환경 변수 설정
  │     └─ [ ] 도메인 생성
  ├─ [ ] 프론트엔드 배포
  │     ├─ [ ] Root Directory 설정
  │     ├─ [ ] Build/Start 명령어
  │     ├─ [ ] 환경 변수 설정
  │     └─ [ ] 도메인 생성
  └─ [ ] FRONTEND_URL 업데이트

배포 후
  ├─ [ ] 백엔드 health check
  ├─ [ ] 프론트엔드 접속
  ├─ [ ] 워크스페이스 생성 테스트
  ├─ [ ] AI 채팅 테스트
  ├─ [ ] 파일 CRUD 테스트
  └─ [ ] 지갑 연결 테스트

완료! 🎉
```

---

이 플로우차트를 참고하여 Railway 배포를 진행하세요!

**더 자세한 내용**: `RAILWAY_배포가이드.md` 참조


